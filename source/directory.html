<!DOCTYPE HTML>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>AMWA</title>
		<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
		<link rel="stylesheet" href="css/style.css" />
		<script src="js/jquery-2.1.3.min.js"></script>
		<script src="js/jquery.mobile-1.4.5.min.js"></script>
		<script src="main.js"></script>
	
	</head>

<body>

<div id="directoryPage" data-role="page" data-theme="a"  >
	
	<div data-role="header" data-position="fixed" data-theme="b">
		
			

			 <a href="#mypanel" class="ui-btn ui-btn-inline ui-icon-menu-bars ui-btn-icon-notext ui-corner-all ui-shadow ui-nodisc-icon" style="background-color:#E68538;border:none">Without circle</a>   
		
		<img class=" ui-btn-right " src="images/logo.png" height="40px" width="40px" />
		<h6>Atlantic Metal Working Association</h6>
	</div>

	<div data-role="content" style="background-color:#E68538" >
		
		
		
		
		<p style="text-align:center" id="loading"><img src="images/ajax-loader.gif" /></p>
	
					
		<ul id="company-list"  data-role="listview" data-filter="true" data-inset="false" data-theme="a" class="animClass" data-icon="next" ></ul>
			
	</div><!-- content -->


	

	<div data-role="panel" id="filter-panel" data-position="left" data-display="overlay" data-theme="a">
    	<!-- panel content goes here -->
    		<form id="frm-search">
		
			
			<select name="ddl-province" id="ddl-province" onchange="GetCities()" data-mini="true" style="border:none" ></select>
			
			<select name="ddl-city" id="ddl-city" data-mini="true"  ></select>
			  
			<div data-role="controlgroup" data-mini="true" id="cg-services" data-inset="false"></div>
			
			<button type="submit" id="btn-search" data-mini="true" data-rel="close">Apply Filters</button>
				
		</form>
		</div><!-- /panel -->


	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
				
				<li>
					<a href="#filter-panel" class="ui-link ui-btn ui-icon-filter ui-btn-icon-top ui-shadow ui-corner-all ui-btn-active ui-nodisc-icon" style="background-color:#E68538;border:none"></a> 
				</li>
				
			</ul>
		</div>
	</div><!-- footer -->

	<div data-role="panel" data-position="left" data-position-fixed="false" data-display="reveal" id="mypanel" data-theme="a">
		<p style="text-align:center"><img src="images/mcf.png" width="70%" /></p>
		<div style="height:20px"></div>
		<ul data-role="listview" data-filter="false" data-theme="a" data-inset="false">
			<li>
				<a href="wods.html" data-rel="close" class="ui-btn ui-shadow ui-btn-b ui-icon-mcfit ui-btn-icon-right" data-ajax="false">WODs</a>
			</li>
		</ul>
	</div><!-- /panel -->

	<script type="text/javascript">
	
		$(document).delegate("#directoryPage", "pagebeforeshow", function() {
			$("#loading").show();
			GetServices();
			
		});
		
		$(document).delegate("#directoryPage", "pageshow", function() {
			GetProvinces();
			
			Search();
		});
				
				function GetProvinces(){
					$.ajax({
							type : "POST",
							url : "http://www.mycfit.ca/site_amwa_services/get_provinces.php",
							data : {},
							async: false,
							dataType : "json",
							success : function(data) {
								
								if(data.count > 0){
									$("#ddl-province").empty();
									$("#ddl-province").append("<option value='-1'>Select a Province</option>");
									var html = "";
									var xml = data.result;
									xmlDoc = $.parseXML(xml);
									$xml = $(xmlDoc);
									$xml.find("province").each(function() {
										var id = $(this).find('id').text();
										var name = $(this).find('name').text();
									    $("#ddl-province").append("<option value='" + id + "'>" + name + "</option>");
								
									});
								
									$("#ddl-province").selectmenu("refresh");
								}
								
							},
							error : function(xhr, errorType, exception) {
								alert("GetProvinces" + xhr + errorType + exception);
							}
						});
				}
				
				function GetCities(){
					var prov = $("#ddl-province").val();
					
					$.ajax({
							type : "POST",
							url : "http://mycfit.ca/site_amwa_services/get_cities.php",
							async: false,
							data : {'prov' : prov},
							dataType : "json",
							success : function(data) {
								
								if(data.count > 0){
									
									$("#ddl-city").empty();
									$("#ddl-city").append("<option value='-1'>Select a City</option>");
									var html = "";
									var xml = data.result;
									xmlDoc = $.parseXML(xml);
									$xml = $(xmlDoc);
									$xml.find("city").each(function() {
										
										var id = $(this).find('id').text();
										var name = $(this).find('name').text();
										
									    $("#ddl-city").append("<option value='" + id + "'>" + decodeURI(name) + "</option>");
								
									});
								
									$("#ddl-city").selectmenu("refresh");
								}
								
							},
							error : function(xhr, errorType, exception) {
								alert(xhr + errorType + exception);
							}
						});
				}
			
				function GetServices(){
									
					$.ajax({
							type : "POST",
							url : "http://mycfit.ca/site_amwa_services/get_services.php",
							async: false,
							data : {},
							dataType : "json",
							success : function(data) {
								
								if(data.count > 0){
									
									
									var html = "";
									var xml = data.result;
									xmlDoc = $.parseXML(xml);
									$xml = $(xmlDoc);
									$xml.find("service").each(function() {
										
										var id = $(this).find('id').text();
										var name = $(this).find('name').text();
										
    									$("#cg-services").append("<label for='chk" + id + "'>" + name + "</label><input type='checkbox' id='chk" + id + "' name='chk" + id + "' data-mini='true'></input>");
													  
                						$("#chk" + id).checkboxradio();
								
									});
									$("#cg-services").controlgroup( "refresh" );
									
								}
								
							},
							error : function(xhr, errorType, exception) {
								alert("GetServices" + xhr + errorType + exception);
							}
						});
				}
				
				$('#frm-search').submit(function (e) {
					$("#loading").show();
				    e.preventDefault();
				    Search();
				});

			
				function Search(){
					
					var form = $("#frm-search");
					$('#company-list').empty();
					$.ajax({
							type : "POST",
							url : "http://mycfit.ca/site_amwa_services/get_companies.php",
							async: false,
							data : form.serialize(),
							dataType : "json",
							success : function(data) {
								
								var name = "";
								var html = "";
								var xml = data.result;
								xmlDoc = $.parseXML(xml);
								$xml = $(xmlDoc);
								$xml.find("company").each(function() {
									var id = $(this).find('id').text();
									
									name = $(this).find('name').text();
									var address = $(this).find('address').text();
									
									
									
									$("#company-list").append("<li><a href='javascript:GoCompany(" + id + ")'>" + name + "<br >" + address + "</a></li>");
								});
								$("#loading").hide();
								
								
								
								
								
								$('#company-list').listview('refresh');				
							},
							error : function(xhr, errorType, exception) {
								alert("Search" + xhr + errorType + exception);
							}
						}); 
					 
				}
	       
	       function GoCompany(id){
	       	window.localStorage.setItem("CID", id);
	       	window.location="company.html";
	       }
			

			</script>			

</div>

	</body>
</html>
